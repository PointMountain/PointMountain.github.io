<!DOCTYPE html>
<html lang="en-US">
  <head>
    <meta charset="utf-8">
    <meta name="viewport" content="width=device-width,initial-scale=1">
    <title>Ming</title>
    <meta name="generator" content="VuePress 1.4.1">
    <link rel="shortcut icon" type="image/x-icon" href="favicon.ico">
    <meta name="description" content="学习文档">
    <link rel="preload" href="/mo/assets/css/0.styles.4ab656b6.css" as="style"><link rel="preload" href="/mo/assets/js/app.7f6287a1.js" as="script"><link rel="preload" href="/mo/assets/js/2.d35037bb.js" as="script"><link rel="preload" href="/mo/assets/js/25.fe804969.js" as="script"><link rel="prefetch" href="/mo/assets/js/10.aa0b24d6.js"><link rel="prefetch" href="/mo/assets/js/11.e51a83f1.js"><link rel="prefetch" href="/mo/assets/js/12.e57d719d.js"><link rel="prefetch" href="/mo/assets/js/13.9c1c356c.js"><link rel="prefetch" href="/mo/assets/js/14.25a41960.js"><link rel="prefetch" href="/mo/assets/js/15.28e91168.js"><link rel="prefetch" href="/mo/assets/js/16.8875c3c9.js"><link rel="prefetch" href="/mo/assets/js/17.3a12941a.js"><link rel="prefetch" href="/mo/assets/js/18.a9070830.js"><link rel="prefetch" href="/mo/assets/js/19.66f4fdf3.js"><link rel="prefetch" href="/mo/assets/js/20.9232b1f0.js"><link rel="prefetch" href="/mo/assets/js/21.ac33ca2d.js"><link rel="prefetch" href="/mo/assets/js/22.ddddf42e.js"><link rel="prefetch" href="/mo/assets/js/23.ad423f91.js"><link rel="prefetch" href="/mo/assets/js/24.9cdab421.js"><link rel="prefetch" href="/mo/assets/js/26.051c326a.js"><link rel="prefetch" href="/mo/assets/js/27.4e2a51e3.js"><link rel="prefetch" href="/mo/assets/js/28.5a2ce03d.js"><link rel="prefetch" href="/mo/assets/js/29.c6b35440.js"><link rel="prefetch" href="/mo/assets/js/3.3cbe66ae.js"><link rel="prefetch" href="/mo/assets/js/30.5528b0e9.js"><link rel="prefetch" href="/mo/assets/js/31.e725706c.js"><link rel="prefetch" href="/mo/assets/js/32.aa88e40d.js"><link rel="prefetch" href="/mo/assets/js/4.75b2b758.js"><link rel="prefetch" href="/mo/assets/js/5.78933b57.js"><link rel="prefetch" href="/mo/assets/js/6.55bec715.js"><link rel="prefetch" href="/mo/assets/js/7.0288ef42.js"><link rel="prefetch" href="/mo/assets/js/8.3d47ae6e.js"><link rel="prefetch" href="/mo/assets/js/9.17488935.js">
    <link rel="stylesheet" href="/mo/assets/css/0.styles.4ab656b6.css">
  </head>
  <body>
    <div id="app" data-server-rendered="true"><div class="theme-container"><header class="navbar"><div class="sidebar-button"><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" role="img" viewBox="0 0 448 512" class="icon"><path fill="currentColor" d="M436 124H12c-6.627 0-12-5.373-12-12V80c0-6.627 5.373-12 12-12h424c6.627 0 12 5.373 12 12v32c0 6.627-5.373 12-12 12zm0 160H12c-6.627 0-12-5.373-12-12v-32c0-6.627 5.373-12 12-12h424c6.627 0 12 5.373 12 12v32c0 6.627-5.373 12-12 12zm0 160H12c-6.627 0-12-5.373-12-12v-32c0-6.627 5.373-12 12-12h424c6.627 0 12 5.373 12 12v32c0 6.627-5.373 12-12 12z"></path></svg></div> <a href="/mo/" class="home-link router-link-active"><!----> <span class="site-name">Ming</span></a> <div class="links"><div class="search-box"><input aria-label="Search" autocomplete="off" spellcheck="false" value=""> <!----></div> <nav class="nav-links can-hide"><div class="nav-item"><a href="/mo/" class="nav-link">
  Home
</a></div><div class="nav-item"><a href="/mo/Javascript/base.html" class="nav-link">
  Javascript基础
</a></div><div class="nav-item"><div class="dropdown-wrapper"><button type="button" aria-label="Vue" class="dropdown-title"><span class="title">Vue</span> <span class="arrow right"></span></button> <ul class="nav-dropdown" style="display:none;"><li class="dropdown-item"><!----> <a href="/mo/Vue/Vue-base.html" class="nav-link">
  Vue基础使用
</a></li><li class="dropdown-item"><!----> <a href="/mo/Vue/Vue-advanced.html" class="nav-link">
  Vue高级特性
</a></li><li class="dropdown-item"><!----> <a href="/mo/Vue/Vuex.html" class="nav-link">
  Vuex
</a></li><li class="dropdown-item"><!----> <a href="/mo/Vue/Vue-router.html" class="nav-link">
  Vue-router
</a></li><li class="dropdown-item"><!----> <a href="/mo/Vue/Vue-principle.html" class="nav-link">
  Vue原理
</a></li><li class="dropdown-item"><!----> <a href="/mo/Vue/Vue-code.html" class="nav-link">
  Vue源码解析
</a></li></ul></div></div><div class="nav-item"><div class="dropdown-wrapper"><button type="button" aria-label="React" class="dropdown-title"><span class="title">React</span> <span class="arrow right"></span></button> <ul class="nav-dropdown" style="display:none;"><li class="dropdown-item"><!----> <a href="/mo/React/React-State.html" class="nav-link">
  React State
</a></li><li class="dropdown-item"><!----> <a href="/mo/React/React-Props.html" class="nav-link">
  React Props
</a></li><li class="dropdown-item"><!----> <a href="/mo/React/React-Refs.html" class="nav-link">
  React Refs
</a></li><li class="dropdown-item"><!----> <a href="/mo/React/React-Router.html" class="nav-link">
  React Router
</a></li><li class="dropdown-item"><!----> <a href="/mo/React/React-Redux.html" class="nav-link">
  React Redux Router
</a></li><li class="dropdown-item"><!----> <a href="/mo/React/React-Extension.html" class="nav-link">
  React Extension
</a></li><li class="dropdown-item"><!----> <a href="/mo/React/React-cli-proxy.html" class="nav-link">
  React脚手架配置代理
</a></li></ul></div></div><div class="nav-item"><a href="/mo/webpack/" class="nav-link">
  webpack
</a></div><div class="nav-item"><a href="/mo/Typescript/" class="nav-link">
  Typescript
</a></div><div class="nav-item"><div class="dropdown-wrapper"><button type="button" aria-label="杂记" class="dropdown-title"><span class="title">杂记</span> <span class="arrow right"></span></button> <ul class="nav-dropdown" style="display:none;"><li class="dropdown-item"><!----> <a href="/mo/others/" class="nav-link router-link-active">
  基础学习
</a></li><li class="dropdown-item"><!----> <a href="/mo/others/Network.html" class="nav-link">
  网络学习
</a></li><li class="dropdown-item"><!----> <a href="/mo/others/SomeInterview.html" class="nav-link">
  面试整理
</a></li><li class="dropdown-item"><!----> <a href="/mo/others/Connect.html" class="nav-link router-link-exact-active router-link-active">
  网络连接方式
</a></li><li class="dropdown-item"><!----> <a href="/mo/others/Monitor.html" class="nav-link">
  前端监控
</a></li><li class="dropdown-item"><!----> <a href="/mo/others/Performance.html" class="nav-link">
  性能优化
</a></li><li class="dropdown-item"><!----> <a href="/mo/others/SomeJS.html" class="nav-link">
  随手写代码
</a></li><li class="dropdown-item"><!----> <a href="/mo/others/myPromise.html" class="nav-link">
  Promise代码
</a></li></ul></div></div><div class="nav-item"><a href="https://github.com/PointMountain/mo" target="_blank" rel="noopener noreferrer" class="nav-link external">
  GayHub
  <svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg></a></div> <!----></nav></div></header> <div class="sidebar-mask"></div> <aside class="sidebar"><nav class="nav-links"><div class="nav-item"><a href="/mo/" class="nav-link">
  Home
</a></div><div class="nav-item"><a href="/mo/Javascript/base.html" class="nav-link">
  Javascript基础
</a></div><div class="nav-item"><div class="dropdown-wrapper"><button type="button" aria-label="Vue" class="dropdown-title"><span class="title">Vue</span> <span class="arrow right"></span></button> <ul class="nav-dropdown" style="display:none;"><li class="dropdown-item"><!----> <a href="/mo/Vue/Vue-base.html" class="nav-link">
  Vue基础使用
</a></li><li class="dropdown-item"><!----> <a href="/mo/Vue/Vue-advanced.html" class="nav-link">
  Vue高级特性
</a></li><li class="dropdown-item"><!----> <a href="/mo/Vue/Vuex.html" class="nav-link">
  Vuex
</a></li><li class="dropdown-item"><!----> <a href="/mo/Vue/Vue-router.html" class="nav-link">
  Vue-router
</a></li><li class="dropdown-item"><!----> <a href="/mo/Vue/Vue-principle.html" class="nav-link">
  Vue原理
</a></li><li class="dropdown-item"><!----> <a href="/mo/Vue/Vue-code.html" class="nav-link">
  Vue源码解析
</a></li></ul></div></div><div class="nav-item"><div class="dropdown-wrapper"><button type="button" aria-label="React" class="dropdown-title"><span class="title">React</span> <span class="arrow right"></span></button> <ul class="nav-dropdown" style="display:none;"><li class="dropdown-item"><!----> <a href="/mo/React/React-State.html" class="nav-link">
  React State
</a></li><li class="dropdown-item"><!----> <a href="/mo/React/React-Props.html" class="nav-link">
  React Props
</a></li><li class="dropdown-item"><!----> <a href="/mo/React/React-Refs.html" class="nav-link">
  React Refs
</a></li><li class="dropdown-item"><!----> <a href="/mo/React/React-Router.html" class="nav-link">
  React Router
</a></li><li class="dropdown-item"><!----> <a href="/mo/React/React-Redux.html" class="nav-link">
  React Redux Router
</a></li><li class="dropdown-item"><!----> <a href="/mo/React/React-Extension.html" class="nav-link">
  React Extension
</a></li><li class="dropdown-item"><!----> <a href="/mo/React/React-cli-proxy.html" class="nav-link">
  React脚手架配置代理
</a></li></ul></div></div><div class="nav-item"><a href="/mo/webpack/" class="nav-link">
  webpack
</a></div><div class="nav-item"><a href="/mo/Typescript/" class="nav-link">
  Typescript
</a></div><div class="nav-item"><div class="dropdown-wrapper"><button type="button" aria-label="杂记" class="dropdown-title"><span class="title">杂记</span> <span class="arrow right"></span></button> <ul class="nav-dropdown" style="display:none;"><li class="dropdown-item"><!----> <a href="/mo/others/" class="nav-link router-link-active">
  基础学习
</a></li><li class="dropdown-item"><!----> <a href="/mo/others/Network.html" class="nav-link">
  网络学习
</a></li><li class="dropdown-item"><!----> <a href="/mo/others/SomeInterview.html" class="nav-link">
  面试整理
</a></li><li class="dropdown-item"><!----> <a href="/mo/others/Connect.html" class="nav-link router-link-exact-active router-link-active">
  网络连接方式
</a></li><li class="dropdown-item"><!----> <a href="/mo/others/Monitor.html" class="nav-link">
  前端监控
</a></li><li class="dropdown-item"><!----> <a href="/mo/others/Performance.html" class="nav-link">
  性能优化
</a></li><li class="dropdown-item"><!----> <a href="/mo/others/SomeJS.html" class="nav-link">
  随手写代码
</a></li><li class="dropdown-item"><!----> <a href="/mo/others/myPromise.html" class="nav-link">
  Promise代码
</a></li></ul></div></div><div class="nav-item"><a href="https://github.com/PointMountain/mo" target="_blank" rel="noopener noreferrer" class="nav-link external">
  GayHub
  <svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg></a></div> <!----></nav>  <ul class="sidebar-links"><li><a href="/mo/others/" class="sidebar-link">基础学习</a></li><li><a href="/mo/others/Network.html" class="sidebar-link">网络学习</a></li><li><a href="/mo/others/SomeJS.html" class="sidebar-link">随手写代码</a></li><li><a href="/mo/others/myPromise.html" class="sidebar-link">简单Promise</a></li><li><a href="/mo/others/SomeInterview.html" class="sidebar-link">面试整理</a></li><li><a href="/mo/others/Connect.html" class="active sidebar-link">网络连接方式</a></li><li><a href="/mo/others/Monitor.html" class="sidebar-link">前端监控</a></li><li><a href="/mo/others/Performance.html" class="sidebar-link">性能优化</a></li></ul> </aside> <main class="page"> <div class="theme-default-content content__default"><ol><li>ajax轮询 让浏览器隔一段时间就发送一次请求，询问服务器是否有新信息</li> <li>长连接 类似轮询，区别是客户端发起连接后，如果没有信息，就一直不返回response给客户端，直到服务端有消息才返回，返回完之后，客户端再建立连接，周而复始</li> <li>Server-Sent Events是通过服务端向客户端声明，接下来发送的信息是留信息，做到服务端主动推送信息，不过只能单向的由服务端传到客户端<br>
客户端通过EventSource对象进行使用</li></ol> <div class="language- extra-class"><pre class="language-text"><code> let source = new EventSource(url, { withCredentials: true }) //可跨域，如果跨域的话可以设置第二个参数withCredentials是否传输cookie
 //EventSource实例中有只读属性readyState 0表示还未建立或正在重连 1表示连接已经建立可以接收数据，2表示连接已断，且不会重连
 source.addEventListener('open',(event)=&gt;{

 })
 source.addEventListener('message',(event)=&gt;{

 })
 source.addEventListener('error',()=&gt;{

 })
 //EventSource还支持自定义事件
 source.close() //关闭连接
</code></pre></div><p>服务端方面：
必须设置<code>Content-type: text/event-stream</code><br>
返回的信息格式是：<code>data|event|id|retry: value</code><br>
如果一次信息由多个message组成每个message直接用\n\n分隔<br>
data字段表示数据内容，event字段表示事件类型默认是message也可以自定义事件，id字段表示数据编号可以用lastEventId读取 如果断线的话就会发送一个带有Last-Event-ID请求头的信息，进行断线重连，retry字段指定浏览器重新发送连接的时间间隔</p> <div class="language- extra-class"><pre class="language-text"><code>let http = require('http')
http.createServer((res, req)=&gt;{
  let fileName = '.'+req.url
  if(fileName === './stream'){
    res.writeHead(200, {
      &quot;Content-Type&quot;:&quot;text/event-stream&quot;,
      &quot;Cache-Control&quot;:&quot;no-cache&quot;,
      &quot;Connection&quot;:&quot;keep-alive&quot;,
      &quot;Access-Control-Allow-Origin&quot;: '*',
    });
    res.write(&quot;retry: 10000\n&quot;);
    res.write(&quot;event: connecttime\n&quot;);
    res.write(&quot;data: &quot; + (new Date()) + &quot;\n\n&quot;);
    res.write(&quot;data: &quot; + (new Date()) + &quot;\n\n&quot;);

    interval = setInterval(function () {
      res.write(&quot;data: &quot; + (new Date()) + &quot;\n\n&quot;);
    }, 1000);

    req.connection.addListener(&quot;close&quot;, function () {
      clearInterval(interval);
    }, false);
  }
}).listen(8080, '127.0.0.1')
</code></pre></div><ol start="4"><li>WebSocket使用了websocket协议，全双工通信，实时性更强。更好的二进制支持。
服务端</li></ol> <div class="language- extra-class"><pre class="language-text"><code>let WebSocketServer = require('ws').Server
let wsServer = new WebSocketServer({port: 8888})
wsServer.on('connection',socket =&gt;{
  console.log('连接成功');
  socket.on('message', message =&gt;{
    console.log('接收到客户端消息:' + message);
    socket.send('服务器回应:' + message)
  })
})
</code></pre></div><p>客户端</p> <div class="language- extra-class"><pre class="language-text"><code> let ws = new WebSocket('ws: xxxx')
 //WebSocket实例中有属性readyState 0表示正在连接 1表示连接已经建立可以进行通信，2表示连接正在关闭 3表示连接已经关闭或者打开连接失败
 ws.addEventListener('open',(event)=&gt;{
    ws.send('Hello Server!');
 })
 ws.addEventListener('message',(event)=&gt;{

 })
 ws.addEventListener('error',()=&gt;{

 })
 ws.close() //关闭连接
</code></pre></div><p>WebSocket只支持GET方法 且状态码为101表示协议切换
请求时请求头有<code>Sec-WebSocket-Version</code>、<code>Sec-WebSocket-Key</code>
响应头有<code>Sec-WebSocket-Accept</code></p></div> <footer class="page-edit"><!----> <!----></footer> <div class="page-nav"><p class="inner"><span class="prev">
      ←
      <a href="/mo/others/SomeInterview.html" class="prev">
        面试整理
      </a></span> <span class="next"><a href="/mo/others/Monitor.html">
        前端监控
      </a>
      →
    </span></p></div> </main></div><div class="global-ui"></div></div>
    <script src="/mo/assets/js/app.7f6287a1.js" defer></script><script src="/mo/assets/js/2.d35037bb.js" defer></script><script src="/mo/assets/js/25.fe804969.js" defer></script>
  </body>
</html>
